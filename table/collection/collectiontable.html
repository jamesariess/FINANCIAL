<style>
      .status-badge {
        padding: 4px 12px;
        border-radius: 9999px;
        font-size: 0.875rem;  
        font-weight: 500;
        display: inline-block;
    }
     .status-paid {
        background-color: #dcfce7; 
        color: #166534;          
        border: 1px solid #86efac;
    }
    .status-reject {
        background-color: #fee2e2; 
        color: #991b1b;            
        border: 1px solid #fca5a5;
    }

    
    .status-default {
        background-color: #e5e7eb; 
        color: #374151;
        border: 1px solid #d1d5db;
    }
</style>
<div class="table-section" id="disbursementTableSection">
      <h3>Plan Report</h3>
      <table id="employeesTable"> 
          <thead>
      <tr>
        <th>ID</th>
        <th>Plan Title</th>
        <th>Remaining Days</th>
        <th>Plan Type</th>
        <th>Status</th>
        <th>Created At</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="employeesTableBody">
      <?php if (!empty($plans)): ?>
        <?php foreach ($plans as $row): 
            $date = date('F j, Y \a\t g:i A', strtotime($row['Date'])); 
        ?>
          <tr>
            <td><?php echo htmlspecialchars($row['planID']); ?></td>
            <td><?php echo htmlspecialchars($row['plan']); ?></td>
            <td><?php echo htmlspecialchars($row['remaining_days']); ?></td>
            <td><?php echo htmlspecialchars($row['plan_type']); ?></td>
           
            <td>
              <?php
              $status = strtolower($row['status']);
              $statusClass = "status-default";

              switch($status){
                case "active":
                $statusClass= "status-paid";
                break;
                case "inactive":
                $statusClass = "status-reject";
                break;
              }?>
              <span class="status-badge <?php echo $statusClass;?>">
                <?php echo htmlspecialchars($row['status']);?>
              </span>
            </td>

            <td><?php echo htmlspecialchars($date); ?></td>
         
<td>
  <!-- View -->
  <a href="?id=<?php echo $row['planID']?>"
     onclick="openViewModal(
       '<?php echo $row['planID']; ?>',
       '<?php echo htmlspecialchars($row['plan'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['remaining_days'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['plan_type'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['status'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['Date'], ENT_QUOTES); ?>'
     ); return false;" >
     üëÅÔ∏è View
  </a>

  <!-- Update -->
  <a href="?update_id=<?php echo $row['planID']?>"
     onclick="openUpdateModal(
       '<?php echo $row['planID']; ?>',
       '<?php echo htmlspecialchars($row['plan'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['remaining_days'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['plan_type'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['status'], ENT_QUOTES); ?>',
       '<?php echo htmlspecialchars($row['Date'], ENT_QUOTES); ?>'
     ); return false;">
     ‚úèÔ∏è Update
  </a>

  <!-- Archive -->
  <a href="?archive_id=<?php echo $row['planID']?>"
     onclick="openArchiveModal(
       '<?php echo $row['planID']; ?>',
       '<?php echo htmlspecialchars($row['plan'], ENT_QUOTES); ?>'
     ); return false;">
     üì¶ Archive
  </a>
</td>

           

          </tr>
        <?php endforeach; ?>
      <?php else: ?>
        <tr>
          <td colspan="7">No collection plans found.</td>
        </tr>
      <?php endif; ?>
    </tbody>
      </table>
    </div>


<!-- ‚úÖ VIEW MODAL -->
<div id="viewModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" onclick="outsideclick(event, 'viewModal')">
  <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md relative">
    <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold" onclick="closeModal('viewModal')">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Plan Details</h2>
    <div class="space-y-2">
      <p><span class="font-medium">ID:</span> <span id="modalPlanID"></span></p>
      <p><span class="font-medium">Plan Title:</span> <span id="modalPlanTitle"></span></p>
      <p><span class="font-medium">Remaining Days:</span> <span id="modalRemaining"></span></p>
      <p><span class="font-medium">Plan Type:</span> <span id="modalPlanType"></span></p>
      <p><span class="font-medium">Status:</span> <span id="modalStatus"></span></p>
      <p><span class="font-medium">Created At:</span> <span id="modalDate"></span></p>
    </div>
  </div>
</div>

<!-- ‚úÖ UPDATE MODAL -->
<div id="updateModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" onclick="outsideclick(event, 'updateModal')">
  <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md relative">
    <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold" onclick="closeModal('updateModal')">&times;</button>
    <h2 class="text-xl font-semibold mb-4">Update Plan</h2>
    <form method="POST"  class="space-y-4">
      <input type="hidden" name="planID" id="updatePlanID">
      <div class="form-group">
        <label class="block text-sm font-medium">Plan Title</label>
        <input type="text" name="plan" id="updatePlanTitle" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300">
      </div>
      <div class="form-group">
        <label class="block text-sm font-medium">Remaining Days</label>
        <input type="number" name="remaining" id="updateRemaining" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300">
      </div>
      <div class="form-group">
        <label class="block text-sm font-medium">Plan Type</label>
        <select name="type" id="updatePlanType"  class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300">
         
          <option value="Automated">Automated</option>
          <option value="Manual">Manual</option>
          <option value="Mixed / Hybrid">Mixed / Hybrid</option>
        </select>
       
      </div>
      <div class="form-group">
        <label class="block text-sm font-medium">Status</label>
        <select name="status" id="updateStatus" class="w-full border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300">
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
    
      </div>
   
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="closeModal('updateModal')" class="px-4 py-2 bg-red-500 rounded-lg hover:bg-red-600">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" name="update">Save Changes</button>
      </div>
    </form>
  </div>
</div>






<div id="archiveModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" onclick="outsideclick(event, 'archiveModal')">
  <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm relative">
    <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold" onclick="closeModal('archiveModal')">&times;</button>
    <svg class="mx-auto mb-4 text-gray-400 w-12 h-12 dark:text-gray-200" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                </svg>
    <p class="mb-4">Are you sure you want to archive <span class="font-medium" id="archivePlanTitle"></span> (ID: <span id="archivePlanID"></span>)?</p>
    <form method="POST"  class="flex justify-end space-x-3">
      <input type="hidden" name="planID" id="archiveHiddenID">
      <button type="button" onclick="closeModal('archiveModal')" class="px-4 py-2 bg-blue-200 rounded-lg hover:bg-blue-300">Cancel</button>
      <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" name="archive">Yes, Archive</button>
    </form>
  </div>
</div>

<script>
function openViewModal(id, title, remaining, type, status, date) {
  document.getElementById("modalPlanID").innerText = id;
  document.getElementById("modalPlanTitle").innerText = title;
  document.getElementById("modalRemaining").innerText = remaining;
  document.getElementById("modalPlanType").innerText = type;
  document.getElementById("modalStatus").innerText = status;
  const formattedDate = new Date(date).toLocaleString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
  document.getElementById("modalDate").innerText = formattedDate;
  document.getElementById("viewModal").classList.remove("hidden");
}

function openUpdateModal(id, title, remaining, type, status, date) {
  document.getElementById("updatePlanID").value = id;
  document.getElementById("updatePlanTitle").value = title;
  document.getElementById("updateRemaining").value = remaining;
  document.getElementById("updatePlanType").value = type;
  document.getElementById("updateStatus").value = status;

  document.getElementById("updateModal").classList.remove("hidden");
}

function openArchiveModal(id, title) {
  document.getElementById("archivePlanID").innerText = id;
  document.getElementById("archivePlanTitle").innerText = title;
  document.getElementById("archiveHiddenID").value = id;
  document.getElementById("archiveModal").classList.remove("hidden");
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.add("hidden");
}
function outsideclick(event, modalId) {
  if (event.target.id === modalId) {
    closeModal(modalId);
  }
}
</script>
