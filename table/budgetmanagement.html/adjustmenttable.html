<style>
    .status-badge {
        padding: 4px 12px;
        border-radius: 9999px;
        font-size: 0.875rem;  
        font-weight: 500;
        display: inline-block;
    }
    .status-paid {
        background-color: #dcfce7; 
        color: #166534;          
        border: 1px solid #86efac;
    }
    .status-reject {
        background-color: #fee2e2; 
        color: #991b1b;            
        border: 1px solid #fca5a5;
    }
    .status-default {
        background-color: #e5e7eb; 
        color: #374151;
        border: 1px solid #d1d5db;
    }
</style>
<div class="table-section" id="allocationAdjustmentTableSection">
    <h3>Allocation Adjustment Report</h3>
    <table id="allocationAdjustmentTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>New Percentage</th>
                <th>Old Percentage</th> 
                <th>New Amount</th>
                <th>Old Amount</th>
                <th>Reason</th>
                <th>Change Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <?php if (!empty($allocationAdjustments)): ?>
                <?php foreach ($allocationAdjustments as $row): 
                    $date = date('F j, Y \a\t g:i A', strtotime($row['ChaneDate'] ?? 'now')); 
                ?>
                    <tr>
                        <td><?php echo htmlspecialchars($row['allocateadjustmentID']); ?></td>
                        <td><?php echo htmlspecialchars($row['Title']); ?></td>
                        <td><?php echo htmlspecialchars($row['newpercent']); ?>%</td>
                        <td><?php echo htmlspecialchars($row['oldpercent']); ?>%</td> 
                        <td><?php echo htmlspecialchars(number_format($row['newamount'], 2)); ?></td>
                        <td><?php echo htmlspecialchars(number_format($row['oldamount'], 2)); ?></td>
                        <td><?php echo htmlspecialchars($row['Reason']); ?></td>
                        <td><?php echo htmlspecialchars($date); ?></td>
                        <td>
                            <!-- View -->
                            <a href="?id=<?php echo $row['allocateadjustmentID']?>"
                               onclick="openViewModal(
                                 '<?php echo $row['allocateadjustmentID']; ?>',
                                 '<?php echo htmlspecialchars($row['Title'], ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars($row['newpercent'], ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars($row['oldpercent'], ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars(number_format($row['newamount'], 2), ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars(number_format($row['oldamount'], 2), ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars($row['Reason'], ENT_QUOTES); ?>',
                                 '<?php echo htmlspecialchars($row['ChaneDate'], ENT_QUOTES); ?>'
                               ); return false;" >
                               üëÅÔ∏è View
                            </a>

                         
                        </td>
                    </tr>
                <?php endforeach; ?>
            <?php else: ?>
                <tr>
                    <td colspan="9">No allocation adjustments found.</td>
                </tr>
            <?php endif; ?>
        </tbody>
    </table>
</div>

<!-- View Modal -->
<div id="viewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" onclick="outsideClick(event, 'viewModal')">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3 relative" onclick="event.stopPropagation()">
        <h2 class="text-lg font-bold mb-4">View Budget Adjustment</h2>
        <div class="space-y-2">
            <p><strong>ID:</strong> <span id="viewAdjustID"></span></p>
            <p><strong>Title:</strong> <span id="viewTitle"></span></p>
            <p><strong>New Percentage:</strong> <span id="viewNewPercent"></span>%</p>
            <p><strong>Old Percentage:</strong> <span id="viewOldPercent"></span>%</p>
            <p><strong>New Amount:</strong> <span id="viewNewAmount"></span></p>
            <p><strong>Old Amount:</strong> <span id="viewOldAmount"></span></p>
            <p><strong>Reason:</strong> <span id="viewReason"></span></p>
            <p><strong>Change Date:</strong> <span id="viewChangeDate"></span></p>
        </div>
        <button class="mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400" onclick="closeModal('viewModal')">Close</button>
    </div>
</div>



<script>
function openViewModal(adjustID, title, newPercent, oldPercent, newAmount, oldAmount, reason, changeDate) {
    document.getElementById('viewAdjustID').innerText = adjustID;
    document.getElementById('viewTitle').innerText = title;
    document.getElementById('viewNewPercent').innerText = newPercent;
    document.getElementById('viewOldPercent').innerText = oldPercent;
    document.getElementById('viewNewAmount').innerText = newAmount;
    document.getElementById('viewOldAmount').innerText = oldAmount;
    document.getElementById('viewReason').innerText = reason;
    document.getElementById('viewChangeDate').innerText = changeDate;
    document.getElementById('viewModal').classList.remove('hidden');
}


function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}

function outsideClick(event, modalId) {
    if (event.target.id === modalId) {
        closeModal(modalId);
    }
}
</script>