<style>
    .status-badge {
        padding: 4px 12px;
        border-radius: 9999px; /* pill shape */
        font-size: 0.875rem;   /* text-sm */
        font-weight: 500;
        display: inline-block;
    }
    .status-paid {
        background-color: #dcfce7; 
        color: #166534;          
        border: 1px solid #86efac;
    }
    .status-approved {
        background-color: #dbeafe; 
        color: #1e40af;           
        border: 1px solid #93c5fd;
    }
    .status-reject {
        background-color: #fee2e2; 
        color: #991b1b;            
        border: 1px solid #fca5a5;
    }
    .status-verified {
        background-color: #ffedd5; 
        color: #9a3412;           
        border: 1px solid #fdba74;
    }
    .status-default {
        background-color: #e5e7eb; 
        color: #374151;
        border: 1px solid #d1d5db;
    }
</style>

<div class="table-section" id="disbursementTableSection">
    <h3>Request Report</h3>
    <table id="employeesTable"> 
        <thead>
            <tr>
                <th>Request ID</th>
                <th>Title</th>
                <th>Request Type</th>
                <th>Amount</th>
                <th>Request By</th>
                <th>Due Date</th>
                <th>Purpuse</th>
                <th>Status</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="employeesTableBody">
            <?php if(!empty($disbursementReports)):
            foreach($disbursementReports as $row): ?>
            <tr>
                <td><?php echo htmlspecialchars($row['requestID']);?></td>
                <td><?php echo htmlspecialchars($row['requestTiTle']);?></td>
                <td><?php echo htmlspecialchars($row['accountName']);?></td>
                <td>
                  ‚Ç± <?php 
                 if (!empty($row['Amount'])) {
            echo number_format($row['Amount'], 0, ".", ","); 
                       } else {
            echo "0";
        }
                   ?>
              </td>
                <td><?php echo htmlspecialchars($row['Requested_by']);?></td>
                <td><?php if (!empty($row['Due'])) {
                        echo date("F j, Y", strtotime($row['Due']));} else {
                        echo "-";}?></td>
             <td><?php echo htmlspecialchars($row['Purpuse']);?></td>
        <td>
           
    <?php 
        $status = strtolower($row['status']);
        $statusClass = "status-default";

        switch ($status) {
            case "paid":
                $statusClass = "status-paid";
                break;
            case "approved":
                $statusClass = "status-approved";
                break;
            case "reject":
            case "rejected":
                $statusClass = "status-reject";
                break;
            case "verified":
                $statusClass = "status-verified";
                break;
        }
    ?>
    <span class="status-badge <?php echo $statusClass; ?>">
        <?php echo htmlspecialchars($row['status']); ?>
    </span>
</td>

                <td> <?php 
                    if (!empty($row['date'])) {
                        echo date("F j, Y g:i A", strtotime($row['date'])); 
                    } else {
                        echo "-";
                    }
                ?></td>
                <td>
                    <a href="#"
                       onclick="openViewModal(
                           '<?php echo $row['requestID'];?>',
                           '<?php echo htmlspecialchars($row['requestTiTle'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['accountName'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Amount'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Requested_by'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Due'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['status'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Purpuse'], ENT_QUOTES);?>');
                           
                       return false;">
                       üëÅÔ∏è View
                    </a>
                    <a href="#"
                       onclick="openUpdateModal(
                           '<?php echo $row['requestID'];?>',
                           '<?php echo htmlspecialchars($row['requestTiTle'], ENT_QUOTES);?>',
                    
                           '<?php echo htmlspecialchars($row['Amount'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Requested_by'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['Due'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['status'], ENT_QUOTES);?>',
                           '<?php echo htmlspecialchars($row['date'], ENT_QUOTES);?>');
                       return false;">
                       ‚úèÔ∏è Update
                    </a>
                    <a href="#"
                       onclick="openArchiveModal('<?php echo $row['requestID']?>'); return false;">
                       üóÑÔ∏è Archive
                    </a>
                </td>
            </tr>
            <?php endforeach; else:?>
            <tr><td colspan="9" class="text-center p-4">NO Records Found.</td></tr>
            <?php endif;?>
        </tbody>
    </table>
</div>

<div id="viewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" onclick="outsideClick(event, 'viewModal')">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3 relative" onclick="event.stopPropagation()">
        <h2 class="text-lg font-bold mb-4">View Request</h2>
        <div class="space-y-2">
            <p><strong>Request ID:</strong> <span id="viewRequestId"></span></p>
            <p><strong>Title:</strong> <span id="viewTitle"></span></p>
            <p><strong>Request Type:</strong> <span id="viewModules"></span></p>
            <p><strong>Amount:</strong> <span id="viewAmount"></span></p>
            <p><strong>Requested By:</strong> <span id="viewRequestedBy"></span></p>
            <p><strong>Due Date:</strong> <span id="viewDue"></span></p>
            <p><strong>Status:</strong> <span id="viewStatus"></span></p>
           
         
            <p><strong>Purpuse:</strong> <span id="viewPurpuse"></span></p>
        </div>
        <button class="mt-4 px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400" onclick="closeModal('viewModal')">Close</button>
    </div>
</div>


<div id="updateModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" onclick="outsideClick(event, 'updateModal')">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3 relative" onclick="event.stopPropagation()">
        <button class="absolute top-2 right-2 text-gray-500 hover:text-black" onclick="closeModal('updateModal')">&times;</button>
        <h2 class="text-lg font-bold mb-4">Update Request</h2>
        <form method="post">
            <input type="hidden" name="update_request_id" id="updateRequestId">
            <div class="space-y-4">
                <div>
                    <label for="updateTitle" class="block text-gray-700">Title:</label>
                    <input type="text" name="update_title" id="updateTitle" class="w-full p-2 border rounded" required>

             


                    <label for="updateAmount" class="block text-gray-700">Amount:</label>
                    <input type="number" name="update_amount" id="updateAmount" class="w-full p-2 border rounded" required>

                    <label for="updateRequestedBy" class="block text-gray-700">Requested By:</label>
                    <input type="text" name="update_requested_by" id="updateRequestedBy" class="w-full p-2 border rounded" required>

                    <label for="updateDue" class="block text-gray-700">Due Date:</label>
                    <input type="date" name="update_due" id="updateDue" class="w-full p-2 border rounded" required>


                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-4">
                <button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400" onclick="closeModal('updateModal')">Cancel</button>
                <button type="submit" name="update" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Update</button>
            </div>
        </form>
    </div>
</div>


<div id="archiveModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center" onclick="outsideClick(event, 'archiveModal')">
    <div class="bg-white p-6 rounded-lg shadow-lg w-1/3 relative" onclick="event.stopPropagation()">
        <button class="absolute top-2 right-2 text-gray-500 hover:text-black" onclick="closeModal('archiveModal')">&times;</button>
        <h2 class="text-lg font-bold mb-4">Archive Request</h2>
        <p>Are you sure you want to archive this Request record?</p>
        <form method="post">
            <div class="flex justify-end space-x-3 mt-4">
                <input type="hidden" name="archive_disbursement_id" id="archiveDisbursementId">
                <button type="submit" name="archive" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Archive</button>
                <button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400" onclick="closeModal('archiveModal')">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
function openViewModal(requestID, title, modules, amount, requestedBy, due, status, Purpuse) {
    document.getElementById('viewRequestId').innerText = requestID;
    document.getElementById('viewTitle').innerText = title;
    document.getElementById('viewModules').innerText = modules;
    document.getElementById('viewAmount').innerText = amount;
    document.getElementById('viewRequestedBy').innerText = requestedBy;
    document.getElementById('viewDue').innerText = due;
    document.getElementById('viewStatus').innerText = status;
    document.getElementById('viewPurpuse').innerText=Purpuse;
    document.getElementById('viewModal').classList.remove('hidden');
}

function openUpdateModal(requestID, title,  amount, requestedBy, due, status, date) {
    document.getElementById('updateRequestId').value = requestID;
    document.getElementById('updateTitle').value = title;
   
    document.getElementById('updateAmount').value = amount;
    document.getElementById('updateRequestedBy').value = requestedBy;
    document.getElementById('updateDue').value = due;
    document.getElementById('updateModal').classList.remove('hidden');
}

function openArchiveModal(disbursementId) {
    document.getElementById('archiveDisbursementId').value = disbursementId;
    document.getElementById('archiveModal').classList.remove('hidden');
}
function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}
function outsideClick(event, modalId) {
    if (event.target.id === modalId) {
        closeModal(modalId);
    }
}
</script>