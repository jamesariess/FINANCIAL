<div class="modal-overlay" id="modalOverlay">
  <div class="form-collection" id="collectionform">
    <legend>Follow Up / Reminders</legend>
    
    <!-- Add method="post" -->
    <form method="post">
      <input type="hidden" name="reminderID" id="RequestId">
 
  <div class="form-group">
    <label for="InvoiceID" class="block text-sm font-medium text-gray-700">Invoice Reference</label>
    <select name="InvoiceID" id="InvoiceID" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        <option value="">Select Invoice</option>
        <?php
        try {
            // âœ… Count only active (Archive = 'NO') follow-ups
            $sql = "SELECT i.invoice_id, i.reference_no
                    FROM ar_invoices i
                    LEFT JOIN (
                        SELECT InvoiceID, COUNT(*) as follow_count
                        FROM follow
                        WHERE Archive = 'NO'
                        GROUP BY InvoiceID
                    ) f ON i.invoice_id = f.InvoiceID
                    WHERE i.Archive = 'NO'
                      AND (f.follow_count IS NULL OR f.follow_count < 2)
                    ORDER BY i.created_at DESC";

            $stmt = $pdo->prepare($sql);
            $stmt->execute();
            $invoices = $stmt->fetchAll(PDO::FETCH_ASSOC);

            if ($invoices) {
                foreach ($invoices as $invoice) {
                    echo '<option value="' . htmlspecialchars($invoice['invoice_id']) . '">' 
                        . htmlspecialchars($invoice['reference_no']) 
                        . '</option>';
                }
            } else {
                echo '<option value="">No invoices available</option>';
            }
        } catch (PDOException $e) {
            echo '<option value="">Error loading invoices: ' . $e->getMessage() . '</option>';
        }
        ?>
    </select>
</div>



      <div class="form-group">
        <label for="planID" class="block text-sm font-medium text-gray-700">Plan</label>
        <select name="planID" id="planID" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
          <option value="">Select Plan</option>
          <?php
          try {
              $sql = "SELECT planID, plan FROM collection_plan WHERE status = 'Active' AND Archive = 'NO' ORDER BY planID ASC";
              $stmt = $pdo->prepare($sql);
              $stmt->execute();
              $plans = $stmt->fetchAll(PDO::FETCH_ASSOC);
              foreach ($plans as $plan) {
                  echo '<option value="' . htmlspecialchars($plan['planID']) . '">' . htmlspecialchars($plan['plan']) . '</option>';
              }
          } catch (PDOException $e) {
              echo '<option value="">Error loading plans: ' . $e->getMessage() . '</option>';
          }
          ?>
        </select>
      </div>

    




        <div class="form-group">
  <label for="Contactinfo">Contact Info</label>
  <select id="Contactinfo" name="Contactinfo" 
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm 
                 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
    <option value="">Select Contact</option>
    <option value="Email">Email</option>
    <option value="Facebook">Facebook</option>
    <option value="Number">Number</option>
    <option value="Phone">Phone</option>
  </select>
</div>

  <div class="form-group">
  <label for="Remarks">Remarks</label>
  <select id="Remarks" name="Remarks" 
          class="mt-1 block w-full border-gray-300 rounded-md shadow-sm 
                 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
    <option value="">Select Remark</option>
    <option value="Failed To Sent">Failed To Sent</option>
    <option value="Email not Working">Email not Working</option>
    <option value="Under Review">Under Review</option>
    <option value="Reminder Sent">Reminder Sent</option>
  </select>
</div>


      <div class="form-actions">
        <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
        <!-- Add value so PHP detects it -->
        <button type="submit" name="create" value="1" class="btn btn-primary">Submit Request</button>
      </div>
    </form>
  </div>
</div>

<script>
  const toggleFormBtn = document.getElementById('toggleFormBtn');
const modalOverlay = document.getElementById('modalOverlay');
const cancelBtn = document.getElementById('cancelBtn');

toggleFormBtn.addEventListener('click', () => {
  modalOverlay.style.display = 'flex';
});

cancelBtn.addEventListener('click', () => {
  modalOverlay.style.display = 'none';
});

// Optional: Close modal when clicking outside
modalOverlay.addEventListener('click', (e) => {
  if (e.target === modalOverlay) {
    modalOverlay.style.display = 'none';
  }
});

</script>